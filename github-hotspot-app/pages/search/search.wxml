<!-- pages/search/search.wxml -->
<view class="container">
  <!-- 搜索框 -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <image class="search-icon" src="../../images/search.png" mode="aspectFit"></image>
      <input class="search-input" 
             placeholder="搜索GitHub仓库" 
             placeholder-class="search-placeholder"
             value="{{searchQuery}}"
             bindinput="onSearchInput"
             bindconfirm="onSearch"
             confirm-type="search"
             focus="{{autoFocus}}">
      </input>
      <view class="clear-btn" bindtap="clearSearch" wx:if="{{searchQuery.length > 0}}">
        <image src="../../images/clear.png" mode="aspectFit"></image>
      </view>
    </view>
    <button class="search-btn" bindtap="onSearch">搜索</button>
  </view>
  
  <!-- 搜索历史 -->
  <view class="search-history" wx:if="{{!hasSearched && searchHistory.length > 0}}">
    <view class="history-header">
      <text class="history-title">搜索历史</text>
      <text class="clear-history" bindtap="clearHistory">清空</text>
    </view>
    <view class="history-list">
      <view class="history-item" wx:for="{{searchHistory}}" wx:key="*this" bindtap="onHistoryItemTap" data-query="{{item}}">
        <image class="history-icon" src="../../images/history.png" mode="aspectFit"></image>
        <text class="history-text">{{item}}</text>
      </view>
    </view>
  </view>
  
  <!-- 搜索结果 -->
  <block wx:if="{{hasSearched}}">
    <!-- 搜索结果统计 -->
    <view class="results-stats" wx:if="{{totalCount > 0}}">
      <text>找到 {{totalCount}} 个相关仓库</text>
    </view>
    
    <!-- 搜索结果列表 -->
    <view class="search-results">
      <block wx:if="{{searchResults.length > 0}}">
        <repo-card 
          wx:for="{{searchResults}}" 
          wx:key="id" 
          repo="{{item}}" 
          isFavorited="{{item.isFavorited}}"
          bind:favoriteChange="onFavoriteChange">
        </repo-card>
      </block>
      
      <!-- 加载中 -->
      <view class="loading" wx:if="{{isLoading}}">
        <view class="loading-icon"></view>
        <text>加载中...</text>
      </view>
      
      <!-- 无结果提示 -->
      <view class="empty-tip" wx:if="{{!isLoading && hasSearched && searchResults.length === 0}}">
        <image src="../../images/empty.png" mode="aspectFit"></image>
        <text>未找到相关仓库</text>
      </view>
      
      <!-- 加载更多提示 -->
      <view class="load-more" wx:if="{{!isLoading && hasMore && searchResults.length > 0}}">
        <text>上拉加载更多</text>
      </view>
      
      <!-- 已加载全部提示 -->
      <view class="footer-tip" wx:if="{{!isLoading && !hasMore && searchResults.length > 0}}">
        <text>已加载全部</text>
      </view>
    </view>
  </block>
  
  <!-- 未搜索提示 -->
  <view class="empty-tip" wx:if="{{!hasSearched && searchHistory.length === 0}}">
    <image src="../../images/search_tip.png" mode="aspectFit"></image>
    <text>搜索GitHub仓库</text>
  </view>
</view> 